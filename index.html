<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flag Quiz Game</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        .game-screen {
            padding: 2rem;
            border-radius: 10px;
            background-color: #f8f9fa;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }

        #flag-container {
            min-height: 240px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #flag-container img {
            max-width: 100%;
            max-height: 240px;
            border: 1px solid #ddd;
        }

        .correct {
            color: #28a745;
            font-weight: bold;
        }

        .incorrect {
            color: #dc3545;
            font-weight: bold;
        }

        .result {
            color: #17a2b8;
            font-weight: bold;
        }

        #country-input {
            font-size: 1.2rem;
        }

        #feedback {
            min-height: 30px;
        }

        #timer {
            font-size: 1.2rem;
            font-weight: bold;
            color: #17a2b8;
        }

        .game-controls {
            margin-top: 20px;
        }

        .progress {
            height: 25px;
            margin-bottom: 15px;
        }

        #hint-container {
            padding: 10px;
            background-color: #f0f8ff;
            border-radius: 5px;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .home-icon {
            position: fixed;
            top: 1rem;
            left: 1rem;
            font-size: 2rem;
            color: #0d6efd;
            cursor: pointer;
            z-index: 1000;
            transition: transform 0.2s;
        }

        .home-icon:hover {
            transform: scale(1.1);
            color: #0a58ca;
        }

        .btn-space {
            margin: 0 5px;
        }

        .continent-card {
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-bottom: 15px;
            height: 100%;
        }
        
        .continent-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        .continent-card.selected {
            border: 3px solid #0d6efd;
            box-shadow: 0 5px 15px rgba(13, 110, 253, 0.3);
        }
        
        .continent-count {
            font-size: 0.9rem;
            color: #6c757d;
        }
        
        .nav-tabs .nav-link {
            cursor: pointer;
        }
        
        .mode-content {
            padding-top: 20px;
        }
    </style>
</head>
<body>
    <!-- Home Icon -->
    <div class="home-icon" onclick="goHome()">
        <i class="bi bi-globe-americas"></i>
    </div>

    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-8 text-center">
                <h1 class="mt-5 mb-4">Flag Quiz Game</h1>
                
                <!-- Start Screen -->
                <div id="start-screen" class="game-screen">
                    <p class="lead mb-4">Test your knowledge of country flags!</p>
                    
                    <!-- Quiz Mode Tabs -->
                    <ul class="nav nav-tabs mb-4" id="quiz-mode-tabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="all-countries-tab" data-bs-toggle="tab" data-bs-target="#all-countries" type="button" role="tab" aria-controls="all-countries" aria-selected="true">All Countries</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="by-continent-tab" data-bs-toggle="tab" data-bs-target="#by-continent" type="button" role="tab" aria-controls="by-continent" aria-selected="false">By Continent</button>
                        </li>
                    </ul>
                    
                    <!-- Tab Content -->
                    <div class="tab-content" id="quiz-mode-content">
                        <!-- All Countries Tab -->
                        <div class="tab-pane fade show active" id="all-countries" role="tabpanel" aria-labelledby="all-countries-tab">
                            <p>Try to guess all 196 countries in the world.</p>
                            <button id="start-all-button" class="btn btn-primary btn-lg">Start Full Quiz</button>
                        </div>
                        
                        <!-- By Continent Tab -->
                        <div class="tab-pane fade" id="by-continent" role="tabpanel" aria-labelledby="by-continent-tab">
                            <p>Select a continent to focus your quiz:</p>
                            
                            <div class="row row-cols-1 row-cols-md-3 g-4 mb-4">
                                <!-- Africa -->
                                <div class="col">
                                    <div class="card h-100 continent-card" data-continent="Africa">
                                        <div class="card-body">
                                            <h5 class="card-title">Africa</h5>
                                            <p class="continent-count" id="africa-count"></p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Asia -->
                                <div class="col">
                                    <div class="card h-100 continent-card" data-continent="Asia">
                                        <div class="card-body">
                                            <h5 class="card-title">Asia</h5>
                                            <p class="continent-count" id="asia-count"></p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Europe -->
                                <div class="col">
                                    <div class="card h-100 continent-card" data-continent="Europe">
                                        <div class="card-body">
                                            <h5 class="card-title">Europe</h5>
                                            <p class="continent-count" id="europe-count"></p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- North America -->
                                <div class="col">
                                    <div class="card h-100 continent-card" data-continent="North America">
                                        <div class="card-body">
                                            <h5 class="card-title">North America</h5>
                                            <p class="continent-count" id="north-america-count"></p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- South America -->
                                <div class="col">
                                    <div class="card h-100 continent-card" data-continent="South America">
                                        <div class="card-body">
                                            <h5 class="card-title">South America</h5>
                                            <p class="continent-count" id="south-america-count"></p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Oceania -->
                                <div class="col">
                                    <div class="card h-100 continent-card" data-continent="Oceania">
                                        <div class="card-body">
                                            <h5 class="card-title">Oceania</h5>
                                            <p class="continent-count" id="oceania-count"></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <button id="start-continent-button" class="btn btn-primary btn-lg" disabled>Start Continent Quiz</button>
                        </div>
                    </div>
                </div>
                
                <!-- Game Screen -->
                <div id="game-screen" class="game-screen d-none">
                    <div class="mb-4">
                        <!-- Timer Display -->
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <div id="timer">Time: 00:00</div>
                            <div id="progress-count">0/196 countries</div>
                        </div>
                        
                        <!-- Progress Bar -->
                        <div class="progress mb-4">
                            <div id="progress-bar" class="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">0%</div>
                        </div>
                        
                        <div id="flag-container" class="mb-3">
                            <!-- Flag will be displayed here -->
                        </div>
                        
                        <!-- Hint Container -->
                        <div id="hint-container" class="d-none mb-3">
                            <span id="hint-text"></span>
                        </div>
                        
                        <div class="mb-3">
                            <p>Guess <span id="current-guess">1</span> of 3</p>
                        </div>
                        
                        <div class="input-group mb-3">
                            <input type="text" id="country-input" class="form-control" placeholder="Type a country name" list="country-list" autocomplete="off">
                            <button id="guess-button" class="btn btn-primary">Guess</button>
                        </div>
                        
                        <datalist id="country-list">
                            <!-- Will be populated by JavaScript -->
                        </datalist>
                        
                        <div id="feedback" class="mt-3 mb-3"></div>
                        
                        <button id="next-button" class="btn btn-success d-none">Next Flag</button>
                        
                        <!-- Game Control Buttons -->
                        <div class="game-controls">
                            <button id="reset-button" class="btn btn-warning">Reset Game</button>
                            <button id="give-up-button" class="btn btn-danger">Give Up</button>
                        </div>
                    </div>
                </div>
                
                <!-- Result Screen -->
                <div id="result-screen" class="game-screen d-none">
                    <div id="result-message"></div>
                    <p>You correctly identified <span id="correct-count">0</span> flags in <span id="final-time">00:00</span>!</p>
                    <div class="mt-4">
                        <button id="play-again-button" class="btn btn-primary btn-lg btn-space">Play Again</button>
                        <button onclick="goHome()" class="btn btn-secondary btn-lg btn-space">Back to Home</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Country data with continents
            const countries = [
                {"name": "Afghanistan", "code": "af", "continent": "Asia", "information": "این دومین راهنمایی شماست. در این کشور مردم فارسی گفتار میکنند."},
                {"name": "Albania", "code": "al", "continent": "Europe", "information": "Kjo është pista juaj e dytë. Ky vend ka histori të pasur."},
                {"name": "Algeria", "code": "dz", "continent": "Africa", "information": "هذه هي التلميحة الثانية لك. هذا البلد يحمل ارثًا ثقافيًا غنيًا."},
                {"name": "Andorra", "code": "ad", "continent": "Europe", "information": "Aquesta és la teva segona pista. Aquest país és situat entre Espanya i França."},
                {"name": "Angola", "code": "ao", "continent": "Africa", "information": "Esta é a sua segona pista. Aqui se fala português e há paisagens exuberantes."},
                {"name": "Antigua and Barbuda", "code": "ag", "continent": "North America", "information": "This is your second hint. This island nation is famous for its 365 beaches."},
                {"name": "Argentina", "code": "ar", "continent": "South America", "information": "Esta es tu segunda pista. Es famoso por el tango y el asado."},
                {"name": "Armenia", "code": "am", "continent": "Asia", "information": "Խա ազգառս ե ձեք հայտնիքը: Այս երկիրը հայտնի է իր պատմությամբ։"},
                {"name": "Australia", "code": "au", "continent": "Oceania", "information": "This is your second hint. This country is known for unique wildlife like kangaroos."},
                {"name": "Austria", "code": "at", "continent": "Europe", "information": "Dies ist dein zweiter Hinweis. Dieses Land ist bekannt für die Alpen und klassische Musik."},
                {"name": "Azerbaijan", "code": "az", "continent": "Asia", "information": "Bu sizin ikinci ipucunuzdur. Bura odlar yurdu olaraq bilinir."},
                {"name": "Bahamas", "code": "bs", "continent": "North America", "information": "This is your second hint. This place has crystal-clear waters and vibrant culture."},
                {"name": "Bahrain", "code": "bh", "continent": "Asia", "information": "هذا هو تلميحك الثاني. هذا المكان مشهور باللؤلؤ والصيد البحري."},
                {"name": "Bangladesh", "code": "bd", "continent": "Asia", "information": "এটা আপনার দ্বিতীয় ইঙ্গিত. এটি নদী এবং সুস্বাদু মিষ্টির জন্য বিখ্যাত।"},
                {"name": "Barbados", "code": "bb", "continent": "North America", "information": "This is your second hint. This island is known for its beautiful beaches and rum."},
                {"name": "Belarus", "code": "by", "continent": "Europe", "information": "Это ваша вторая подсказка. Эта страна известна своими лесами и озерами."},
                {"name": "Belgium", "code": "be", "continent": "Europe", "information": "Dit is je tweede hint. Dit land is beroemd om zijn chocolade en bier."},
                {"name": "Belize", "code": "bz", "continent": "North America", "information": "This is your second hint. This place has a rich Mayan heritage and a barrier reef."},
                {"name": "Benin", "code": "bj", "continent": "Africa", "information": "Ceci est votre deuxième indice. Cet endroit est connu pour son histoire vaudou."},
                {"name": "Bhutan", "code": "bt", "continent": "Asia", "information": "འདི་ཁྱེད་ཀྱི་གཉིས་པའི་རྟགས་རེད། འབྲུག་ཡུལ་ལ་རི་མོ་དང་གཞས་གཏོང་གི་ལམ་ཡང་བཟང་རེད།"},
                {"name": "Bolivia", "code": "bo", "continent": "South America", "information": "Esta es tu segunda pista. Aquí se encuentra el desierto de sal más grande del mundo."},
                {"name": "Bosnia and Herzegovina", "code": "ba", "continent": "Europe", "information": "Ovo je vaša druga naznaka. Ova zemlja ima bogatu istoriju i predivne planine."},
                {"name": "Botswana", "code": "bw", "continent": "Africa", "information": "This is your second hint. This country is famous for its wildlife and the Okavango Delta."},
                {"name": "Brazil", "code": "br", "continent": "South America", "information": "Esta é a sua segunda pista. Aqui se celebra o Carnaval com muita alegria."},
                {"name": "Brunei", "code": "bn", "continent": "Asia", "information": "Ini petunjuk kedua anda. Negara ini terkenal dengan istana terbesar di dunia."},
                {"name": "Bulgaria", "code": "bg", "continent": "Europe", "information": "Това е втората ви улика. Тук се намират красиви планини и Черно море."},
                {"name": "Burkina Faso", "code": "bf", "continent": "Africa", "information": "Ceci est votre deuxième indice. Ce pays est connu pour son artisanat et ses masques."},
                {"name": "Burundi", "code": "bi", "continent": "Africa", "information": "Hii ni dokezo lako la pili. Nchi hii ina ngoma za kitamaduni za kuvutia."},
                {"name": "Cabo Verde", "code": "cv", "continent": "Africa", "information": "Esta é a sua segunda pista. Este arquipélago é conhecido pela sua música e praias."},
                {"name": "Cambodia", "code": "kh", "continent": "Asia", "information": "នេះគឺជាប្រយោគជំនួយទីពីរ។ ប្រទេសនេះមានវិមានអង្គរវត្ត។"},
                {"name": "Cameroon", "code": "cm", "continent": "Africa", "information": "Ceci est votre deuxième indice. Ce pays a une grande diversité culturelle et linguistique."},
                {"name": "Canada", "code": "ca", "continent": "North America", "information": "This is your second hint. This country is known for maple syrup and hockey."},
                {"name": "Central African Republic", "code": "cf", "continent": "Africa", "information": "Ceci est votre deuxième indice. Ce pays possède une faune diversifiée et de vastes forêts."},
                {"name": "Chad", "code": "td", "continent": "Africa", "information": "Ceci est votre deuxième indice. Ce pays est en grande partie couvert par le désert du Sahara."},
                {"name": "Chile", "code": "cl", "continent": "South America", "information": "Esta es tu segunda pista. Este país es conocido por su geografía extrema y los Andes."},
                {"name": "China", "code": "cn", "continent": "Asia", "information": "这是你的第二个提示。这里有世界最长的长城。"},
                {"name": "Colombia", "code": "co", "continent": "South America", "information": "Esta es tu segunda pista. Este país es famoso por su café y biodiversidad."},
                {"name": "Comoros", "code": "km", "continent": "Africa", "information": "Hii ni dokezo lako la pili. Taifa hili lina visiwa vyenye mandhari nzuri."},
                {"name": "Congo", "code": "cg", "continent": "Africa", "information": "Ceci est votre deuxième indice. Ce pays est couvert de vastes forêts tropicales."},
                {"name": "Costa Rica", "code": "cr", "continent": "North America", "information": "Esta es tu segunda pista. Este país es famoso por su biodiversidad y ecoturismo."},
                {"name": "Croatia", "code": "hr", "continent": "Europe", "information": "Ovo je vaša druga naznaka. Ova zemlja ima predivnu obalu i otoke."},
                {"name": "Cuba", "code": "cu", "continent": "North America", "information": "Esta es tu segunda pista. Este lugar es famoso por la música y los autos clásicos."},
                {"name": "Cyprus", "code": "cy", "continent": "Europe", "information": "Αυτή είναι η δεύτερη υπόδειξή σας. Το νησί έχει πλούσια ιστορία και όμορφες παραλίες."},
                {"name": "Czech Republic", "code": "cz", "continent": "Europe", "information": "Toto je váš druhý náznak. Tato země je známá svými hrady a pivem."},
                {"name": "Denmark", "code": "dk", "continent": "Europe", "information": "Dette er dit andet hint. Dette land er kendt for sine eventyr og hygge."},
                {"name": "Djibouti", "code": "dj", "continent": "Africa", "information": "Ceci est votre deuxième indice. Ce pays possède un des ports les plus stratégiques d'Afrique."},
                {"name": "Dominica", "code": "dm", "continent": "North America", "information": "This is your second hint. This island nation is known for its lush rainforests and hot springs."},
                {"name": "Dominican Republic", "code": "do", "continent": "North America", "information": "Esta es tu segunda pista. Este país comparte una isla con otra nación."},
                {"name": "Democratic Republic of the Congo", "code": "cd", "continent": "Africa", "information": "Ceci est votre deuxième indice. Ce pays possède la deuxième plus grande forêt tropicale du monde."},
                {"name": "Ecuador", "code": "ec", "continent": "South America", "information": "Esta es tu segunda pista. Aquí se encuentran las Islas Galápagos."},
                {"name": "Egypt", "code": "eg", "continent": "Africa", "information": "هذه هي التلميحة الثانية لك. هذه الأرض هي موطن الأهرامات العظيمة."},
                {"name": "El Salvador", "code": "sv", "continent": "North America", "information": "Esta es tu segunda pista. Es el país más pequeño de América Central."},
                {"name": "Equatorial Guinea", "code": "gq", "continent": "Africa", "information": "Esta es tu segunda pista. Es el único país africano donde el español es idioma oficial."},
                {"name": "Eritrea", "code": "er", "continent": "Africa", "information": "ይህ የእርስዎ ሁለተኛ ምልክት ነው። ይህ ሀገር ባህላዊ በጎለል እና ትልቅ ባህር ያለው ነው።"},
                {"name": "Estonia", "code": "ee", "continent": "Europe", "information": "See on teie teine vihje. See riik on tuntud oma tehnoloogilise arengu ja digiriigi poolest."},
                {"name": "Eswatini", "code": "sz", "continent": "Africa", "information": "This is your second hint. This nation has one of the last absolute monarchies in Africa."},
                {"name": "Ethiopia", "code": "et", "continent": "Africa", "information": "ይህ የእርስዎ ሁለተኛ ምልክት ነው። ይህ ሀገር ታሪካዊ ቋንቋ አማርኛ እና አሜሪካን ካትዋል።"},
                {"name": "Fiji", "code": "fj", "continent": "Oceania", "information": "This is your second hint. This tropical paradise is famous for its clear blue waters and islands."},
                {"name": "Finland", "code": "fi", "continent": "Europe", "information": "Tämä on toinen vihjeesi. Tämä maa tunnetaan tuhansista järvistään ja saunoistaan."},
                {"name": "France", "code": "fr", "continent": "Europe", "information": "Ceci est votre deuxième indice. Ce pays est célèbre pour sa cuisine et sa Tour Eiffel."},
                {"name": "Gabon", "code": "ga", "continent": "Africa", "information": "Ceci est votre deuxième indice. Ce pays est recouvert par une grande forêt tropicale."},
                {"name": "Gambia", "code": "gm", "continent": "Africa", "information": "This is your second hint. This is the smallest mainland country in Africa."},
                {"name": "Georgia", "code": "ge", "continent": "Asia", "information": "ეს არის თქვენი მეორე მინიშნება. ეს ქვეყანა ცნობილია ღვინის კულტურით."},
                {"name": "Germany", "code": "de", "continent": "Europe", "information": "Dies ist dein zweiter Hinweis. Dieses Land ist bekannt für seine Autos und Oktoberfest."},
                {"name": "Ghana", "code": "gh", "continent": "Africa", "information": "This is your second hint. This country was the first African nation to gain independence from colonial rule."},
                {"name": "Greece", "code": "gr", "continent": "Europe", "information": "Αυτή είναι η δεύτερη υπόδειξή σας. Η χώρα αυτή είναι γνωστή για την αρχαία της ιστορία και τη φιλοσοφία."},
                {"name": "Grenada", "code": "gd", "continent": "North America", "information": "This is your second hint. This island nation is known as the 'Spice Isle' due to its nutmeg production."},
                {"name": "Guatemala", "code": "gt", "continent": "North America", "information": "Esta es tu segunda pista. Este país tiene una gran herencia maya y volcanes impresionantes."},
                {"name": "Guinea", "code": "gn", "continent": "Africa", "information": "Ceci est votre deuxième indice. Ce pays possède de riches ressources naturelles et une culture vibrante."},
                {"name": "Guinea Bissau", "code": "gw", "continent": "Africa", "information": "Esta é a sua segunda pista. Este país tem um dos maiores arquipélagos costeiros de África."},
                {"name": "Guyana", "code": "gy", "continent": "South America", "information": "This is your second hint. This country is the only English-speaking nation in South America."},
                {"name": "Haiti", "code": "ht", "continent": "North America", "information": "Sa a se dezyèm siy ou. Peyi sa a gen yon istwa revolisyonè ak yon kilti rich."},
                {"name": "Honduras", "code": "hn", "continent": "North America", "information": "Esta es tu segunda pista. Este país tiene ruinas mayas impresionantes como Copán."},
                {"name": "Hungary", "code": "hu", "continent": "Europe", "information": "Ez a második utalásod. Ez az ország híres termálfürdőiről és gulyásleveséről."},
                {"name": "Iceland", "code": "is", "continent": "Europe", "information": "Þetta er annað vísbendingin þín. Þetta land er þekkt fyrir norðurljósin og jökla."},
                {"name": "India", "code": "in", "continent": "Asia", "information": "यह आपका दूसरा संकेत है। यह देश अपने मसालों और विविध संस्कृति के लिए प्रसिद्ध है।"},
                {"name": "Indonesia", "code": "id", "continent": "Asia", "information": "Ini adalah petunjuk kedua Anda. Negara ini memiliki ribuan pulau dan budaya yang kaya."},
                {"name": "Iran", "code": "ir", "continent": "Asia", "information": "این دومین راهنمایی شماست. این کشور به معماری تاریخی و شاعران معروف است."},
                {"name": "Iraq", "code": "iq", "continent": "Asia", "information": "هذه هي التلميحة الثانية لك. هذا البلد هو مهد الحضارات القديمة."},
                {"name": "Ireland", "code": "ie", "continent": "Europe", "information": "This is your second hint. This country is famous for its green landscapes and folklore."},
                {"name": "Israel", "code": "il", "continent": "Asia", "information": "זוהי הרמז השני שלך. ארץ זו בעלת היסטוריה עשירה ומשמעות דתית רבה."},
                {"name": "Italy", "code": "it", "continent": "Europe", "information": "Questo è il tuo secondo indizio. Questo paese è famoso per la pizza e l'arte rinascimentale."},
                {"name": "Ivory Coast", "code": "ci", "continent": "Africa", "information": "Ceci est votre deuxième indice. Ce pays est un important producteur de cacao."},
                {"name": "Jamaica", "code": "jm", "continent": "North America", "information": "This is your second hint. This island nation is famous for reggae music and its beautiful beaches."},
                {"name": "Japan", "code": "jp", "continent": "Asia", "information": "これはあなたの2番目のヒントです。この国は伝統とテクノロジーの融合で有名です。"},
                {"name": "Jordan", "code": "jo", "continent": "Asia", "information": "هذه هي التلميحة الثانية لك. هذا البلد يحتوي على المدينة القديمة البتراء."},
                {"name": "Kazakhstan", "code": "kz", "continent": "Asia", "information": "Бұл сіздің екінші нұсқауыңыз. Бұл ел өзінің кең далаларымен және ғарыш айлағымен танымал."},
                {"name": "Kenya", "code": "ke", "continent": "Africa", "information": "This is your second hint. This country is known for its stunning safaris and wildlife."},
                {"name": "Kiribati", "code": "ki", "continent": "Oceania", "information": "This is your second hint. This island nation is spread across the equator in the Pacific Ocean."},
                {"name": "Kuwait", "code": "kw", "continent": "Asia", "information": "هذه هي التلميحة الثانية لك. هذه الدولة غنية بالنفط وله ساحل جميل."},
                {"name": "Kyrgyzstan", "code": "kg", "continent": "Asia", "information": "Бул сиздин экинчи кеңешиңиз. Бул өлкө кооз тоолору менен белгилүү."},
                {"name": "Laos", "code": "la", "continent": "Asia", "information": "ນີ້ແມ່ນຄຳໃບ້ທີ່ສອງຂອງເຈົ້າ. ປະເທດນີ້ຂື້ນຊື່ດ້ວຍວັດທະນະທຳບຸນກຳ."},
                {"name": "Latvia", "code": "lv", "continent": "Europe", "information": "Šis ir tavs otrais mājiens. Šī valsts ir pazīstama ar savām tautas dziesmām un jūrmalu."},
                {"name": "Lebanon", "code": "lb", "continent": "Asia", "information": "هذه هي التلميحة الثانية لك. هذا البلد يتميز بمزيج فريد من الثقافات."},
                {"name": "Lesotho", "code": "ls", "continent": "Africa", "information": "This is your second hint. This country is completely surrounded by another nation."},
                {"name": "Liberia", "code": "lr", "continent": "Africa", "information": "This is your second hint. This country was founded by freed African-American slaves."},
                {"name": "Libya", "code": "ly", "continent": "Africa", "information": "هذه هي التلميحة الثانية لك. هذا البلد يحتوي على واحدة من أكبر الصحارى في العالم."},
                {"name": "Liechtenstein", "code": "li", "continent": "Europe", "information": "Dies ist dein zweiter Hinweis. Dieses Land ist eines der kleinsten der Welt."},
                {"name": "Lithuania", "code": "lt", "continent": "Europe", "information": "Tai yra jūsų antrasis užuomina. Ši šalis turi ilgą istoriją ir gražią gamtą."},
                {"name": "Luxembourg", "code": "lu", "continent": "Europe", "information": "Ceci est votre deuxième indice. Ce pays est un important centre financier."},
                {"name": "Madagascar", "code": "mg", "continent": "Africa", "information": "Ity no famantarana faharoa ho anao. Ity firenena dia manana biby sy zava-maniry tsy fahita firy."},
                {"name": "Malawi", "code": "mw", "continent": "Africa", "information": "This is your second hint. This country is known as 'The Warm Heart of Africa.'"},
                {"name": "Malaysia", "code": "my", "continent": "Asia", "information": "Ini adalah petunjuk kedua Anda. Negara ini terkenal dengan Menara Petronas."},
                {"name": "Maldives", "code": "mv", "continent": "Asia", "information": "This is your second hint. This country consists of many coral atolls in the Indian Ocean."},
                {"name": "Mali", "code": "ml", "continent": "Africa", "information": "Ceci est votre deuxième indice. Ce pays abrite l'ancienne ville de Tombouctou."},
                {"name": "Malta", "code": "mt", "continent": "Europe", "information": "Dan huwa t-tieni ħjiel tiegħek. Dan il-pajjiż huwa magħruf għall-forti u l-baħar ċar tiegħu."},
                {"name": "Marshall Islands", "code": "mh", "continent": "Oceania", "information": "This is your second hint. This island nation is spread across the Pacific Ocean."},
                {"name": "Mauritania", "code": "mr", "continent": "Africa", "information": "Ceci est votre deuxième indice. Ce pays est en grande partie couvert de désert."},
                {"name": "Mauritius", "code": "mu", "continent": "Africa", "information": "This is your second hint. This island nation is known for its beaches and multicultural society."},
                {"name": "Mexico", "code": "mx", "continent": "North America", "information": "Esta es tu segunda pista. Este país es famoso por su comida picante y su historia azteca."},
                {"name": "Micronesia", "code": "fm", "continent": "Oceania", "information": "This is your second hint. This nation consists of over 600 islands in the Pacific Ocean."},
                {"name": "Moldova", "code": "md", "continent": "Europe", "information": "Acesta este al doilea indiciu. Această țară este cunoscută pentru vinurile sale."},
                {"name": "Monaco", "code": "mc", "continent": "Europe", "information": "Ceci est votre deuxième indice. Ce pays est célèbre pour son Grand Prix et son casino."},
                {"name": "Mongolia", "code": "mn", "continent": "Asia", "information": "Энэ таны хоёр дахь зөвлөгөө. Энэ улс өргөн уудам тал нутгаар алдартай."},
                {"name": "Montenegro", "code": "me", "continent": "Europe", "information": "Ovo je vaša druga naznaka. Ova zemlja ima prelepe planinske pejzaže."},
                {"name": "Morocco", "code": "ma", "continent": "Africa", "information": "هذه هي التلميحة الثانية لك. هذه البلاد معروفة بأسواقها التقليدية والمدن التاريخية."},
                {"name": "Mozambique", "code": "mz", "continent": "Africa", "information": "Esta é a sua segunda pista. Este país tem uma longa costa no Oceano Índico."},
                {"name": "Myanmar", "code": "mm", "continent": "Asia", "information": "ဤသည်သည် သင့်၏ဒုတိယ အကြံပြုချက်ဖြစ်သည်။ ဤနိုင်ငံတွင် နာမည်ကြီးသောပုဂံမြို့ရှိသည်။"},
                {"name": "Namibia", "code": "na", "continent": "Africa", "information": "This is your second hint. This country has vast deserts and unique wildlife."},
                {"name": "Nauru", "code": "nr", "continent": "Oceania", "information": "This is your second hint. This is one of the smallest island nations in the world."},
                {"name": "Nepal", "code": "np", "continent": "Asia", "information": "यो तपाईंको दोस्रो सङ्केत हो। यो देश सगरमाथाको घर हो।"},
                {"name": "Netherlands", "code": "nl", "continent": "Europe", "information": "Dit is je tweede hint. Dit land is beroemd om zijn molens en tulpenvelden."},
                {"name": "New Zealand", "code": "nz", "continent": "Oceania", "information": "This is your second hint. This country is known for its breathtaking landscapes and the haka dance."},
                {"name": "Nicaragua", "code": "ni", "continent": "North America", "information": "Esta es tu segunda pista. Este país tiene grandes lagos y volcanes."},
                {"name": "Niger", "code": "ne", "continent": "Africa", "information": "Ceci est votre deuxième indice. Ce pays est en grande partie couvert par le désert du Sahara."},
                {"name": "Nigeria", "code": "ng", "continent": "Africa", "information": "This is your second hint. This country has the largest population in Africa."},
                {"name": "North Korea", "code": "kp", "continent": "Asia", "information": "이것은 당신의 두 번째 힌트입니다. 이 나라는 비무장지대로 분리되어 있습니다."},
                {"name": "North Macedonia", "code": "mk", "continent": "Europe", "information": "Ова е вашата втора индиција. Оваа земја има богато историско наследство."},
                {"name": "Norway", "code": "no", "continent": "Europe", "information": "Dette er ditt andre hint. Dette landet er kjent for sine fjorder og nordlys."},
                {"name": "Oman", "code": "om", "continent": "Asia", "information": "هذه هي التلميحة الثانية لك. هذا البلد معروف بواحات صحراوية وأسواق تقليدية."},
                {"name": "Pakistan", "code": "pk", "continent": "Asia", "information": "یہ آپ کا دوسرا اشارہ ہے۔ یہ ملک خوبصورت پہاڑوں اور تاریخی مقامات کے لئے مشہور ہے۔"},
                {"name": "Palau", "code": "pw", "continent": "Oceania", "information": "This is your second hint. This island nation is known for its pristine coral reefs."},
                {"name": "Palestine", "code": "ps", "continent": "Asia", "information": "هذه هي التلميحة الثانية لك. هذه الأرض تتمتع بتاريخ طويل ومعقد."},
                {"name": "Panama", "code": "pa", "continent": "North America", "information": "Esta es tu segunda pista. Este país es famoso por su canal interoceánico."},
                {"name": "Papua New Guinea", "code": "pg", "continent": "Oceania", "information": "This is your second hint. This nation has diverse indigenous cultures and over 800 languages spoken."},
                {"name": "Paraguay", "code": "py", "continent": "South America", "information": "Esta es tu segunda pista. Este país es conocido por su gente hospitalaria y su cultura guaraní."},
                {"name": "Peru", "code": "pe", "continent": "South America", "information": "Esta es tu segunda pista. Aquí se encuentra la famosa ciudadela de Machu Picchu."},
                {"name": "Philippines", "code": "ph", "continent": "Asia", "information": "Ito ang iyong pangalawang pahiwatig. Ang bansang ito ay binubuo ng higit sa 7,000 mga isla."},
                {"name": "Poland", "code": "pl", "continent": "Europe", "information": "To jest twoja druga wskazówka. Ten kraj jest znany z historii i tradycyjnych pierogów."},
                {"name": "Portugal", "code": "pt", "continent": "Europe", "information": "Esta é a sua segunda pista. Este país é famoso pelo vinho do Porto e pelos azulejos."},
                {"name": "Qatar", "code": "qa", "continent": "Asia", "information": "هذه هي التلميحة الثانية لك. هذه الدولة غنية بالموارد النفطية وتستضيف فعاليات رياضية كبرى."},
                {"name": "Romania", "code": "ro", "continent": "Europe", "information": "Acesta este al doilea indiciu. Această țară este faimoasă pentru Castelul lui Dracula."},
                {"name": "Russia", "code": "ru", "continent": "Europe", "information": "Это ваша вторая подсказка. Эта страна является самой большой по площади в мире."},
                {"name": "Rwanda", "code": "rw", "continent": "Africa", "information": "This is your second hint. This country is known as the 'Land of a Thousand Hills.'"},
                {"name": "Saint Kitts and Nevis", "code": "kn", "continent": "North America", "information": "This is your second hint. This is one of the smallest independent nations in the Western Hemisphere."},
                {"name": "Saint Lucia", "code": "lc", "continent": "North America", "information": "This is your second hint. This Caribbean island is known for the Piton mountains."},
                {"name": "Saint Vincent and the Grenadines", "code": "vc", "continent": "North America", "information": "This is your second hint. This island nation has many beautiful beaches and sailing spots."},
                {"name": "Samoa", "code": "ws", "continent": "Oceania", "information": "This is your second hint. This Polynesian nation is famous for its traditional tattoo culture."},
                {"name": "San Marino", "code": "sm", "continent": "Europe", "information": "Questo è il tuo secondo indizio. Questo è uno dei più antichi stati sovrani del mondo."},
                {"name": "Sao Tome and Principe", "code": "st", "continent": "Africa", "information": "Esta é a sua segunda pista. Este país insular tem uma rica biodiversidade."},
                {"name": "Saudi Arabia", "code": "sa", "continent": "Asia", "information": "هذه هي التلميحة الثانية لك. هذه الدولة تضم مكة والمدينة المنورة."},
                {"name": "Senegal", "code": "sn", "continent": "Africa", "information": "Ceci est votre deuxième indice. Ce pays est connu pour sa musique mbalax et son hospitalité."},
                {"name": "Serbia", "code": "rs", "continent": "Europe", "information": "Ovo je vaša druga naznaka. Ova zemlja ima bogatu istoriju i tradiciju."},
                {"name": "Seychelles", "code": "sc", "continent": "Africa", "information": "This is your second hint. This island nation is known for its white sandy beaches and rare wildlife."},
                {"name": "Sierra Leone", "code": "sl", "continent": "Africa", "information": "This is your second hint. This country has a history tied to freed African-American slaves."},
                {"name": "Singapore", "code": "sg", "continent": "Asia", "information": "This is your second hint. This city-state is a major global financial hub."},
                {"name": "Slovakia", "code": "sk", "continent": "Europe", "information": "Toto je váš druhý náznak. Táto krajina je známa svojimi hradmi a prírodou."},
                {"name": "Slovenia", "code": "si", "continent": "Europe", "information": "To je vaš drugi namig. Ta država je znana po svojih Alpah in jadranski obali."},
                {"name": "Solomon Islands", "code": "sb", "continent": "Oceania", "information": "This is your second hint. This island nation was a major battleground in World War II."},
                {"name": "Somalia", "code": "so", "continent": "Africa", "information": "هذه هي التلميحة الثانية لك. هذه الدولة لها أطول ساحل في أفريقيا."},
                {"name": "South Africa", "code": "za", "continent": "Africa", "information": "This is your second hint. This country has three capital cities and a diverse culture."},
                {"name": "South Korea", "code": "kr", "continent": "Asia", "information": "이것은 당신의 두 번째 힌트입니다. 이 나라는 K-pop과 기술 산업으로 유명합니다."},
                {"name": "South Sudan", "code": "ss", "continent": "Africa", "information": "This is your second hint. This is the world's youngest country, having gained independence in 2011."},
                {"name": "Spain", "code": "es", "continent": "Europe", "information": "Esta es tu segunda pista. Este país es famoso por la paella y el flamenco."},
                {"name": "Sri Lanka", "code": "lk", "continent": "Asia", "information": "இது உங்கள் இரண்டாவது குறிப்பாகும். இந்த நாடு தேயிலை தோட்டங்களுக்கும் அழகான கடற்கரைகளுக்கும் புகழ்பெற்றது."},
                {"name": "Sudan", "code": "sd", "continent": "Africa", "information": "هذه هي التلميحة الثانية لك. هذا البلد يضم نهر النيل الأطول في العالم."},
                {"name": "Suriname", "code": "sr", "continent": "South America", "information": "Dit is je tweede hint. Dit land heeft een unieke mix van culturen en regenwouden."},
                {"name": "Sweden", "code": "se", "continent": "Europe", "information": "Detta är din andra ledtråd. Detta land är känt för sina vackra skogar och vikingahistoria."},
                {"name": "Switzerland", "code": "ch", "continent": "Europe", "information": "Ceci est votre deuxième indice. Ce pays est célèbre pour ses montres et son chocolat."},
                {"name": "Syria", "code": "sy", "continent": "Asia", "information": "هذه هي التلميحة الثانية لك. هذا البلد يحتوي على بعض من أقدم المدن في العالم."},
                {"name": "Taiwan", "code": "tw", "continent": "Asia", "information": "這是你的第二個提示。這個地方以高科技產業和夜市聞名。"},
                {"name": "Tajikistan", "code": "tj", "continent": "Asia", "information": "Ин ин дувумин ишораи шумост. Ин кишвар кӯҳҳои баланд ва дарёҳои зебо дорад."},
                {"name": "Tanzania", "code": "tz", "continent": "Africa", "information": "This is your second hint. This country is home to Mount Kilimanjaro and the Serengeti."},
                {"name": "Thailand", "code": "th", "continent": "Asia", "information": "นี่คือคำใบ้ที่สองของคุณ ประเทศนี้มีชื่อเสียงในด้านอาหารรสจัดและวัดวาอารามที่สวยงาม"},
                {"name": "Timor-Leste", "code": "tl", "continent": "Asia", "information": "Iha ita nia segunda pista. Nasaun ida ne'e iha lian Tetum no kultura unik."},
                {"name": "Togo", "code": "tg", "continent": "Africa", "information": "Ceci est votre deuxième indice. Ce pays est connu pour ses marchés animés et ses plages."},
                {"name": "Tonga", "code": "to", "continent": "Oceania", "information": "This is your second hint. This Polynesian kingdom is known for its royal heritage and rugby."},
                {"name": "Trinidad and Tobago", "code": "tt", "continent": "North America", "information": "This is your second hint. This nation is famous for its Carnival and steelpan music."},
                {"name": "Tunisia", "code": "tn", "continent": "Africa", "information": "هذه هي التلميحة الثانية لك. هذا البلد يشتهر بآثاره الرومانية العتيقة."},
                {"name": "Turkey", "code": "tr", "continent": "Asia", "information": "Bu sizin ikinci ipucunuzdur. Bu ülke, iki kıta arasında köprü görevi görür."},
                {"name": "Turkmenistan", "code": "tm", "continent": "Asia", "information": "Bu sizin ikinci ipucunuzdur. Bu ülke geniş çölleri ve tarihi İpek Yolu ile bilinir."},
                {"name": "Tuvalu", "code": "tv", "continent": "Oceania", "information": "This is your second hint. This is one of the smallest and least populated nations in the world."},
                {"name": "Uganda", "code": "ug", "continent": "Africa", "information": "This is your second hint. This country is home to the source of the Nile River."},
                {"name": "Ukraine", "code": "ua", "continent": "Europe", "information": "Це ваша друга підказка. Ця країна має багату історію та красиву природу."},
                {"name": "United Arab Emirates", "code": "ae", "continent": "Asia", "information": "هذه هي التلميحة الثانية لك. هذه الدولة تشتهر بناطحات السحاب الفاخرة والصحراء الواسعة."},
                {"name": "United Kingdom", "code": "gb", "continent": "Europe", "information": "This is your second hint. This country is known for its royal family and Shakespeare."},
                {"name": "United States", "code": "us", "continent": "North America", "information": "This is your second hint. This country has 50 states and is known for its cultural influence worldwide."},
                {"name": "Uruguay", "code": "uy", "continent": "South America", "information": "Esta es tu segunda pista. Este país es famoso por su fútbol y su mate."},
                {"name": "Uzbekistan", "code": "uz", "continent": "Asia", "information": "Bu sizning ikkinchi maslahat. Bu mamlakat Buyuk Ipak Yo'lining markazida joylashgan."},
                {"name": "Vanuatu", "code": "vu", "continent": "Oceania", "information": "This is your second hint. This island nation is known for its active volcanoes and traditional bungee jumping."},
                {"name": "Vatican City", "code": "va", "continent": "Europe", "information": "Questo è il tuo secondo indizio. Questo è il più piccolo stato indipendente del mondo."},
                {"name": "Venezuela", "code": "ve", "continent": "South America", "information": "Esta es tu segunda pista. Este país tiene las mayores reservas de petróleo del mundo."},
                {"name": "Vietnam", "code": "vn", "continent": "Asia", "information": "Đây là gợi ý thứ hai của bạn. Đất nước này nổi tiếng với món phở và vịnh Hạ Long."},
                {"name": "Yemen", "code": "ye", "continent": "Asia", "information": "هذه هي التلميحة الثانية لك. هذا البلد يحتوي على صنعاء، إحدى أقدم المدن المأهولة."},
                {"name": "Zambia", "code": "zm", "continent": "Africa", "information": "This is your second hint. This country is home to Victoria Falls, one of the largest waterfalls in the world."},
                {"name": "Zimbabwe", "code": "zw", "continent": "Africa", "information": "This is your second hint. This place is famous for ancient stone ruins and diverse wildlife."}
            ];

            // Game elements
            const startScreen = document.getElementById('start-screen');
            const gameScreen = document.getElementById('game-screen');
            const resultScreen = document.getElementById('result-screen');
            const startAllButton = document.getElementById('start-all-button');
            const startContinentButton = document.getElementById('start-continent-button');
            const flagContainer = document.getElementById('flag-container');
            const countryInput = document.getElementById('country-input');
            const guessButton = document.getElementById('guess-button');
            const nextButton = document.getElementById('next-button');
            const playAgainButton = document.getElementById('play-again-button');
            const resetButton = document.getElementById('reset-button');
            const giveUpButton = document.getElementById('give-up-button');
            const feedback = document.getElementById('feedback');
            const currentGuessSpan = document.getElementById('current-guess');
            const resultMessage = document.getElementById('result-message');
            const countryList = document.getElementById('country-list');
            const timerElement = document.getElementById('timer');
            const progressBar = document.getElementById('progress-bar');
            const progressCount = document.getElementById('progress-count');
            const correctCountSpan = document.getElementById('correct-count');
            const finalTimeSpan = document.getElementById('final-time');
            const hintContainer = document.getElementById('hint-container');
            const hintText = document.getElementById('hint-text');
            const continentCards = document.querySelectorAll('.continent-card');

            // Game state
            let currentCountry = null;
            let guessCount = 0;
            let maxGuesses = 3;
            let validCountries = countries.map(country => country.name.toLowerCase());
            let remainingCountries = [...countries]; // Countries still to be guessed
            let correctlyGuessedCount = 0;
            let startTime;
            let timerInterval;
            let missedCountries = []; // Countries that were missed and need to be shown again later
            let flagsShownSinceMiss = 0; // Counter to track how many flags have been shown
            let minFlagsBetweenMissed = 15; // Minimum number of flags to show before reshowing a missed flag
            let lastCountryCode = null; // Track the last country shown to avoid immediate repeats
            let resetButtonTimeout = null; // Timeout for reset button confirmation
            let giveUpButtonTimeout = null; // Timeout for give up button confirmation
            let selectedContinent = null; // Currently selected continent for filtered quiz
            let totalCountriesInQuiz = countries.length; // Total countries in the current quiz mode

            // Initialize continent counts
            function initializeContinentCounts() {
                const continentCounts = {};
                countries.forEach(country => {
                    continentCounts[country.continent] = (continentCounts[country.continent] || 0) + 1;
                });
                
                // Update the continent count displays
                document.getElementById('africa-count').textContent = `${continentCounts['Africa'] || 0} countries`;
                document.getElementById('asia-count').textContent = `${continentCounts['Asia'] || 0} countries`;
                document.getElementById('europe-count').textContent = `${continentCounts['Europe'] || 0} countries`;
                document.getElementById('north-america-count').textContent = `${continentCounts['North America'] || 0} countries`;
                document.getElementById('south-america-count').textContent = `${continentCounts['South America'] || 0} countries`;
                document.getElementById('oceania-count').textContent = `${continentCounts['Oceania'] || 0} countries`;
            }
            
            // Call this on page load
            initializeContinentCounts();

            // Populate country datalist
            countries.forEach(country => {
                const option = document.createElement('option');
                option.value = country.name;
                countryList.appendChild(option);
            });

            // Event listeners
            startAllButton.addEventListener('click', () => {
                selectedContinent = null;
                totalCountriesInQuiz = countries.length;
                startGame();
            });
            
            startContinentButton.addEventListener('click', () => {
                if (selectedContinent) {
                    const continentCountries = countries.filter(country => country.continent === selectedContinent);
                    totalCountriesInQuiz = continentCountries.length;
                    startGame();
                }
            });
            
            // Continent selection
            continentCards.forEach(card => {
                card.addEventListener('click', () => {
                    // Remove selection from all cards
                    continentCards.forEach(c => c.classList.remove('selected'));
                    
                    // Add selection to clicked card
                    card.classList.add('selected');
                    
                    // Store selected continent
                    selectedContinent = card.dataset.continent;
                    
                    // Enable the start button
                    startContinentButton.disabled = false;
                });
            });
            
            guessButton.addEventListener('click', submitGuess);
            nextButton.addEventListener('click', loadNextFlag);
            playAgainButton.addEventListener('click', startGame);
            resetButton.addEventListener('click', resetGame);
            giveUpButton.addEventListener('click', giveUp);
            countryInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    submitGuess();
                }
            });
            // Add event listener for pressing Enter after correct answer
            document.addEventListener('keypress', (e) => {
                // Only allow Enter to advance to next flag if the next button is visible
                // AND we've already shown feedback (input disabled)
                if (e.key === 'Enter' && !nextButton.classList.contains('d-none') && countryInput.disabled) {
                    // If this was a wrong guess (feedback has alert-danger class), 
                    // ensure user has had time to see the correct answer
                    const wrongGuessFeedback = feedback.querySelector('.alert-danger');
                    const correctGuessFeedback = feedback.querySelector('.alert-success');
                    
                    // Get current timestamp
                    const now = new Date().getTime();
                    
                    // Check if enough time has passed since the feedback was shown
                    if (!nextButton.dataset.feedbackTimestamp) {
                        // This is the first Enter press after showing feedback
                        // Store the current timestamp
                        nextButton.dataset.feedbackTimestamp = now;
                        return; // Don't advance yet, wait for next Enter press
                    } else {
                        // This is a subsequent Enter press, check if enough time has passed
                        const timestamp = parseInt(nextButton.dataset.feedbackTimestamp);
                        // If less than 100ms have passed, this is probably the same Enter keypress
                        // being handled twice. Ignore it.
                        if (now - timestamp < 100) {
                            return;
                        }
                    }
                    
                    // Reset the timestamp
                    nextButton.dataset.feedbackTimestamp = '';
                    loadNextFlag();
                }
            });

            // Start the game
            function startGame() {
                // Reset game state
                remainingCountries = selectedContinent 
                    ? [...countries].filter(country => country.continent === selectedContinent)
                    : [...countries];
                missedCountries = [];
                correctlyGuessedCount = 0;
                flagsShownSinceMiss = minFlagsBetweenMissed; // Initialize to allow missed flags to show after reset
                lastCountryCode = null; // Reset the last country shown
                
                // Update UI
                startScreen.classList.add('d-none');
                resultScreen.classList.add('d-none');
                gameScreen.classList.remove('d-none');
                hintContainer.classList.add('d-none');
                updateProgressBar();
                
                // Update the progress text to reflect the current quiz mode
                if (selectedContinent) {
                    progressCount.textContent = `0/${totalCountriesInQuiz} countries in ${selectedContinent}`;
                } else {
                    progressCount.textContent = `0/${totalCountriesInQuiz} countries`;
                }
                
                // Start timer
                startTime = new Date();
                if (timerInterval) clearInterval(timerInterval);
                timerInterval = setInterval(updateTimer, 1000);
                
                // Load first flag
                loadNextFlag();
            }

            // Load a new flag
            function loadNextFlag() {
                // Reset guess state
                guessCount = 0;
                currentGuessSpan.textContent = '1';
                countryInput.value = '';
                feedback.innerHTML = '';
                nextButton.classList.add('d-none');
                nextButton.dataset.feedbackTimestamp = ''; // Reset feedback timestamp
                hintContainer.classList.add('d-none');
                
                // Also reset confirmation buttons if they're active
                if (resetButton.dataset.confirming === 'true') {
                    resetButton.textContent = 'Reset Game';
                    resetButton.dataset.confirming = 'false';
                    resetButton.classList.remove('btn-danger');
                    resetButton.classList.add('btn-warning');
                    if (resetButtonTimeout) {
                        clearTimeout(resetButtonTimeout);
                        resetButtonTimeout = null;
                    }
                }
                
                if (giveUpButton.dataset.confirming === 'true') {
                    giveUpButton.textContent = 'Give Up';
                    giveUpButton.dataset.confirming = 'false';
                    if (giveUpButtonTimeout) {
                        clearTimeout(giveUpButtonTimeout);
                        giveUpButtonTimeout = null;
                    }
                }
                
                // Enable guess controls
                countryInput.disabled = false;
                guessButton.disabled = false;
                
                // Increment the counter for flags shown since last missed flag
                flagsShownSinceMiss++;
                
                let selectedCountry = null;
                
                // If there are very few remaining countries, we might not be able to wait for 15 flags
                // In this case, combine remaining and missed flags and pick randomly
                if (remainingCountries.length < minFlagsBetweenMissed && missedCountries.length > 0) {
                    // Create a combined list, excluding the last shown country to avoid immediate repeats
                    let combinedList = [...remainingCountries, ...missedCountries]
                        .filter(country => country.code !== lastCountryCode);
                    
                    if (combinedList.length === 0) {
                        // Handle edge case where only one country is left and it's the last shown
                        combinedList = [...remainingCountries, ...missedCountries];
                    }
                    
                    // Select a random country from the combined list
                    const randomIndex = Math.floor(Math.random() * combinedList.length);
                    selectedCountry = combinedList[randomIndex];
                    
                    // Remove from appropriate list
                    const inRemainingIndex = remainingCountries.findIndex(c => c.code === selectedCountry.code);
                    if (inRemainingIndex !== -1) {
                        remainingCountries.splice(inRemainingIndex, 1);
                    } else {
                        const inMissedIndex = missedCountries.findIndex(c => c.code === selectedCountry.code);
                        if (inMissedIndex !== -1) {
                            missedCountries.splice(inMissedIndex, 1);
                        }
                    }
                } 
                // Check if we have any missed countries to show again and if enough other flags have been shown
                else if (missedCountries.length > 0 && flagsShownSinceMiss >= minFlagsBetweenMissed && Math.random() < 0.25) {
                    // 25% chance to show a missed country (but only after showing at least 15 other flags)
                    const randomIndex = Math.floor(Math.random() * missedCountries.length);
                    selectedCountry = missedCountries.splice(randomIndex, 1)[0];
                    // Reset the counter when showing a missed flag
                    flagsShownSinceMiss = 0;
                } else if (remainingCountries.length > 0) {
                    // Otherwise show a new country
                    const randomIndex = Math.floor(Math.random() * remainingCountries.length);
                    selectedCountry = remainingCountries.splice(randomIndex, 1)[0];
                } else if (missedCountries.length > 0) {
                    // If no new countries but still have missed ones, show those regardless of counter
                    const randomIndex = Math.floor(Math.random() * missedCountries.length);
                    selectedCountry = missedCountries.splice(randomIndex, 1)[0];
                    // Reset the counter
                    flagsShownSinceMiss = 0;
                } else {
                    // All countries guessed correctly!
                    endGame();
                    return;
                }
                
                // Update game state with the selected country
                currentCountry = selectedCountry;
                lastCountryCode = currentCountry.code;
                
                displayFlag(currentCountry.code);
            }

            // Display the flag image
            function displayFlag(countryCode) {
                // Use Flag API that supports CORS - Flagpedia.net
                flagContainer.innerHTML = `
                    <img 
                        src="https://flagcdn.com/w320/${countryCode}.png"
                        alt="Flag" 
                        class="img-fluid"
                        crossorigin="anonymous"
                        onerror="this.onerror=null; this.src='https://flagcdn.com/h240/${countryCode}.png'; this.srcset='';"
                    >
                `;
                
                // Add error handling for image loading
                const flagImg = flagContainer.querySelector('img');
                flagImg.addEventListener('error', () => {
                    // Fallback to alternate source if image fails to load
                    flagContainer.innerHTML = `
                        <div class="alert alert-warning">
                            Image could not be loaded.<br>
                            <a href="https://www.countryflags.io/${countryCode}/flat/64.png" target="_blank">View flag</a>
                        </div>
                    `;
                });
            }

            // Show hint based on guess count
            function showHint() {
                if (guessCount === 1) {
                    // First hint: Show continent
                    hintText.textContent = `Hint: This country is in ${currentCountry.continent}`;
                    hintContainer.classList.remove('d-none');
                } else if (guessCount === 2 && currentCountry.information) {
                    // Second hint: Show information
                    hintText.textContent = `Hint: ${currentCountry.information}`;
                    hintContainer.classList.remove('d-none');
                }
            }

            // Process the user's guess
            function submitGuess() {
                if (!countryInput.value.trim()) return;
                
                const userGuess = countryInput.value.trim();
                const correctAnswer = currentCountry.name;
                
                // Check if the guess is a valid country name
                if (!validCountries.includes(userGuess.toLowerCase())) {
                    feedback.innerHTML = `<div class="alert alert-warning">Please enter a valid country name.</div>`;
                    countryInput.value = '';
                    countryInput.focus();
                    return;
                }
                
                if (userGuess.toLowerCase() === correctAnswer.toLowerCase()) {
                    // Correct guess - don't increment guess count
                    feedback.innerHTML = `<div class="alert alert-success">Correct! The answer is ${correctAnswer}.</div>`;
                    countryInput.disabled = true;
                    guessButton.disabled = true;
                    nextButton.classList.remove('d-none');
                    
                    // Update progress
                    correctlyGuessedCount++;
                    updateProgressBar();
                    
                    // Check if all countries have been guessed
                    if (correctlyGuessedCount === countries.length) {
                        endGame();
                    }
                } else {
                    // Incorrect guess - increment guess count
                    guessCount++;
                    currentGuessSpan.textContent = Math.min(guessCount + 1, maxGuesses);
                    
                    // Show hint based on guess count
                    showHint();
                    
                    if (guessCount >= maxGuesses) {
                        // Out of guesses
                        feedback.innerHTML = `<div class="alert alert-danger">Sorry, you're out of guesses. The correct answer is ${correctAnswer}.</div>`;
                        countryInput.disabled = true;
                        guessButton.disabled = true;
                        nextButton.classList.remove('d-none');
                        
                        // Add this country to the missed list to show again later
                        missedCountries.push(currentCountry);
                        // Reset the counter when adding a missed flag
                        flagsShownSinceMiss = 0;
                        
                        // Remove the current country from the remaining countries array (if it's still there)
                        const currentCountryIndex = remainingCountries.findIndex(c => c.code === currentCountry.code);
                        if (currentCountryIndex !== -1) {
                            remainingCountries.splice(currentCountryIndex, 1);
                        }
                    } else {
                        // Still have guesses
                        feedback.innerHTML = `<div class="alert alert-warning">Incorrect guess. Try again. You have ${maxGuesses - guessCount} guesses left.</div>`;
                        countryInput.value = '';
                        countryInput.focus();
                    }
                }
            }

            // Update the progress bar
            function updateProgressBar() {
                const percentage = (correctlyGuessedCount / totalCountriesInQuiz) * 100;
                progressBar.style.width = `${percentage}%`;
                progressBar.textContent = `${Math.round(percentage)}%`;
                progressBar.setAttribute('aria-valuenow', percentage);
                
                if (selectedContinent) {
                    progressCount.textContent = `${correctlyGuessedCount}/${totalCountriesInQuiz} countries in ${selectedContinent}`;
                } else {
                    progressCount.textContent = `${correctlyGuessedCount}/${totalCountriesInQuiz} countries`;
                }
            }

            // Update the timer display
            function updateTimer() {
                const currentTime = new Date();
                const elapsedTime = Math.floor((currentTime - startTime) / 1000); // in seconds
                const minutes = Math.floor(elapsedTime / 60);
                const seconds = elapsedTime % 60;
                timerElement.textContent = `Time: ${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }

            // Reset the game
            function resetGame() {
                // Check if button is already in confirmation state
                if (resetButton.dataset.confirming === 'true') {
                    // Clear timeout
                    if (resetButtonTimeout) {
                        clearTimeout(resetButtonTimeout);
                        resetButtonTimeout = null;
                    }
                    
                    // Reset button to normal state
                    resetButton.textContent = 'Reset Game';
                    resetButton.dataset.confirming = 'false';
                    resetButton.classList.remove('btn-danger');
                    resetButton.classList.add('btn-warning');
                    
                    // Instead of starting the game again, go back to the start screen
                    // Stop the timer
                    if (timerInterval) {
                        clearInterval(timerInterval);
                    }
                    
                    // Show the start screen, hide game and result screens
                    gameScreen.classList.add('d-none');
                    resultScreen.classList.add('d-none');
                    startScreen.classList.remove('d-none');
                    
                    // Reset continent selection
                    continentCards.forEach(card => card.classList.remove('selected'));
                    selectedContinent = null;
                    startContinentButton.disabled = true;
                } else {
                    // Set button to confirmation state
                    resetButton.textContent = 'Confirm Reset';
                    resetButton.dataset.confirming = 'true';
                    resetButton.classList.remove('btn-warning');
                    resetButton.classList.add('btn-danger');
                    
                    // Set timeout to revert button after 3 seconds
                    resetButtonTimeout = setTimeout(() => {
                        resetButton.textContent = 'Reset Game';
                        resetButton.dataset.confirming = 'false';
                        resetButton.classList.remove('btn-danger');
                        resetButton.classList.add('btn-warning');
                        resetButtonTimeout = null;
                    }, 3000);
                }
            }

            // Give up and show current answer
            function giveUp() {
                // Check if button is already in confirmation state
                if (giveUpButton.dataset.confirming === 'true') {
                    // Clear timeout
                    if (giveUpButtonTimeout) {
                        clearTimeout(giveUpButtonTimeout);
                        giveUpButtonTimeout = null;
                    }
                    
                    // Reset button to normal state
                    giveUpButton.textContent = 'Give Up';
                    giveUpButton.dataset.confirming = 'false';
                    
                    // Show the answer for the current flag
                    feedback.innerHTML = `<div class="alert alert-info">The answer is ${currentCountry.name}.</div>`;
                    countryInput.disabled = true;
                    guessButton.disabled = true;
                    nextButton.classList.remove('d-none');
                    
                    // Add this country to the missed list to show again later
                    missedCountries.push(currentCountry);
                    // Reset the counter when adding a missed flag
                    flagsShownSinceMiss = 0;
                    
                    // Remove from remaining if it's still there
                    const currentCountryIndex = remainingCountries.findIndex(c => c.code === currentCountry.code);
                    if (currentCountryIndex !== -1) {
                        remainingCountries.splice(currentCountryIndex, 1);
                    }
                } else {
                    // Set button to confirmation state
                    giveUpButton.textContent = 'Confirm Give Up';
                    giveUpButton.dataset.confirming = 'true';
                    
                    // Set timeout to revert button after 3 seconds
                    giveUpButtonTimeout = setTimeout(() => {
                        giveUpButton.textContent = 'Give Up';
                        giveUpButton.dataset.confirming = 'false';
                        giveUpButtonTimeout = null;
                    }, 3000);
                }
            }

            // End the game and show results
            function endGame() {
                // Stop the timer
                clearInterval(timerInterval);
                
                // Calculate final time
                const endTime = new Date();
                const totalSeconds = Math.floor((endTime - startTime) / 1000);
                const minutes = Math.floor(totalSeconds / 60);
                const seconds = totalSeconds % 60;
                const timeString = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                // Update results screen
                correctCountSpan.textContent = correctlyGuessedCount;
                finalTimeSpan.textContent = timeString;
                
                // Display appropriate message based on performance
                let message = '';
                const percentage = (correctlyGuessedCount / totalCountriesInQuiz) * 100;
                const quizTypeText = selectedContinent ? ` in ${selectedContinent}` : '';
                
                if (percentage === 100) {
                    message = `<div class="alert alert-success">Congratulations! You correctly identified all countries${quizTypeText} in ${timeString}!</div>`;
                } else if (percentage >= 80) {
                    message = `<div class="alert alert-success">Great job! You identified ${correctlyGuessedCount} out of ${totalCountriesInQuiz} countries${quizTypeText} in ${timeString}.</div>`;
                } else if (percentage >= 50) {
                    message = `<div class="alert alert-warning">Not bad! You identified ${correctlyGuessedCount} out of ${totalCountriesInQuiz} countries${quizTypeText} in ${timeString}.</div>`;
                } else {
                    message = `<div class="alert alert-info">You identified ${correctlyGuessedCount} out of ${totalCountriesInQuiz} countries${quizTypeText} in ${timeString}. Keep practicing!</div>`;
                }
                
                resultMessage.innerHTML = message;
                
                // Show results screen
                gameScreen.classList.add('d-none');
                resultScreen.classList.remove('d-none');
            }

            // Add goHome function
            window.goHome = function() {
                // Stop any running timer
                if (timerInterval) {
                    clearInterval(timerInterval);
                }
                
                // Reset game state
                remainingCountries = [...countries];
                missedCountries = [];
                correctlyGuessedCount = 0;
                flagsShownSinceMiss = minFlagsBetweenMissed;
                lastCountryCode = null;
                
                // Reset continent selection
                continentCards.forEach(card => card.classList.remove('selected'));
                selectedContinent = null;
                startContinentButton.disabled = true;
                
                // Show start screen, hide others
                gameScreen.classList.add('d-none');
                resultScreen.classList.add('d-none');
                startScreen.classList.remove('d-none');
                
                // Reset any button states
                if (resetButton.dataset.confirming === 'true') {
                    resetButton.textContent = 'Reset Game';
                    resetButton.dataset.confirming = 'false';
                    resetButton.classList.remove('btn-danger');
                    resetButton.classList.add('btn-warning');
                    if (resetButtonTimeout) {
                        clearTimeout(resetButtonTimeout);
                        resetButtonTimeout = null;
                    }
                }
                
                if (giveUpButton.dataset.confirming === 'true') {
                    giveUpButton.textContent = 'Give Up';
                    giveUpButton.dataset.confirming = 'false';
                    if (giveUpButtonTimeout) {
                        clearTimeout(giveUpButtonTimeout);
                        giveUpButtonTimeout = null;
                    }
                }
            };
        });
    </script>
</body>
</html> 